---
title: "SwiftDataã®@Relationshipã®ä½¿ã„æ–¹"
emoji: "ğŸ¤"
type: "tech"
topics:
  - "swift"
  - "swiftui"
  - "swiftdata"
published: true
published_at: "2024-10-20 23:53"
---

# SwiftDataã£ã¦ä½•ï¼Ÿ
ã“ã¡ã‚‰ã®è¨˜äº‹ãŒå¤§å¤‰å‚è€ƒã«ãªã‚Šã¾ã™ï¼
https://zenn.dev/yumemi_inc/articles/2a929c839b2000#relationship-%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3
# @Relationship
ModelåŒå£«ã‚’è‡ªå‹•ã§é€£æºã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã®ã§ã€ä¾¿åˆ©ãã†ã€‚
https://developer.apple.com/documentation/swiftdata/defining-data-relationships-with-enumerations-and-model-classes/
# ä½¿ã„æ–¹
ä»Šå›ã¯å®Ÿè£…ä¾‹ã¨ã—ã¦ã€Todoã‚¢ãƒ—ãƒªã‚’æƒ³å®šã—ãŸã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
## Modelã®ä½œæˆ
```Swift
@Model
final class Task: Identifiable {
    @Attribute(.unique) var id: UUID
    var name: String
    //ã€€@Relationshipã‚’ã¤ã‘ã¦æ˜ç¤ºçš„ã«ç¹‹ã’ã‚‹ 
    @Relationship(inverse: \ChildTask.parent)
    var childTasks: [ChildTask]

    init(
        id: UUID = .init(),
        name: String,
        childTasks: [ChildTask] = []
    ) {
        self.id = id
        self.name = name
        self.childTasks = childTasks
    }
}

```

```Swift
@Model
final class ChildTask: Identifiable {
    var name: String
    var isDone: Bool

    var parent: Task

    init(
        name: String,
        isDone: Bool = false,
        parent: Task
    ) {
        self.name = name
        self.isDone = isDone
        self.parent = parent
    }
}

```
## Modelã®åˆæœŸåŒ–
```Swift
@main
struct SampleTodoApp: App {
    var sharedModelContainer: ModelContainer = {
        let schema = Schema([
            Task.self,
            ChildTask.self,
        ])
        let modelConfiguration = ModelConfiguration(schema: schema, isStoredInMemoryOnly: false)

        do {
            return try ModelContainer(for: schema, configurations: [modelConfiguration])
        } catch {
            fatalError("Could not create ModelContainer: \(error)")
        }
    }()

    var body: some Scene {
        WindowGroup {
            ContentView()
        }
        .modelContainer(sharedModelContainer)
    }
}

```

## Viewã®ä½œæˆ
tasksã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹éƒ¨åˆ†ã¯ã€ä»Šå›ã®`@Relationship`ã‚’èª¬æ˜ã™ã‚‹ä¸Šã§ã¯çœç•¥ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

â†“ã™ã§ã«`tasks: [Task]`ã«ä¸€ã¤ä»¥ä¸Šãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹æƒ³å®š
```Swift
struct ContentView: View {
    @Environment(\.modelContext) private var modelContext
    @Query var tasks: [Task]

    var body: some View {
        VStack {
            List {
                ForEach(tasks, id: \.id) { task in
                    // ã‚µãƒ³ãƒ—ãƒ«ã®ãŸã‚nilã‚’è€ƒæ…®ã—ã¦ã„ã¾ã›ã‚“
                    let childTask = tasks.childTasks.first
                    HStack {
                        Text(tasks.name)
                        Text("\(childTask?.isDone)")
                        Spacer()
                        Button(action: {
                            onTapButton(task: task)
                        }) {
                            Text("æ›´æ–°")
                        }
                    }
                }
            }
        }
    }

    private func onTapButton(task: Task) {
        let isCompleted = true
        // ã¾ãŸã¯ let isCompleted = false
        let newChildTask = ChildTask(
            name: "å­ã‚¿ã‚¹ã‚¯",
            isCompleted: isCompleted,
            // ã“ã“ã§ç´ä»˜ã‘ã‚‹ï¼ï¼
            task: task
        )
        modelContext.insert(newChildTask)
        do {
            try modelContext.save()
        } catch {
            // ã‚¨ãƒ©ãƒ¼å‡¦ç†
        }
    }
}
```

# ã•ã„ã”ã«
ä¸å‚™ãƒ»é–“é•ã„ç­‰ã‚ã‚Œã°ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚