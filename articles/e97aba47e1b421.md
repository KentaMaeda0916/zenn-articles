---
title: "ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚¢ãƒ—ãƒªã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è‡ªä½œã—ã¦ã¿ãŸ"
emoji: "ðŸŽ"
type: "tech"
topics:
  - "ios"
  - "swift"
  - "swiftui"
  - "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"
published: true
published_at: "2025-01-16 18:23"
---

æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸiOSã®ç´”æ­£ã‚¢ãƒ—ãƒªã‚’è§¦ã£ã¦ã‚‹ã¨ã€ã„ã„æ„Ÿã˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒã‚ã£ãŸã‚“ã§ã™ãŒã€æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ãªã®ã§å†ç¾ã‚’è©¦ã¿ã¾ã—ãŸã€‚

# ä½œã‚ŠãŸã„ã‚‚ã®
![](https://storage.googleapis.com/zenn-user-upload/8eed633f9d71-20250116.gif)
## è¦ä»¶

1. æœˆé¸æŠžãŒã§ãã‚‹
2. çŸ¢å°ã§æœˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹
3. ã€Œä»Šæ—¥ã€ã®è‰²ãŒå¤‰ã‚ã£ã¦ã„ã‚‹
4. æŒ‡å®šã®æ—¥ã®è‰²ã‚’å¤‰æ›´ã§ãã‚‹
ï¼ˆã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚¢ãƒ—ãƒªã§ã„ã†ã¨æ—¥è¨˜ã‚’æ›¸ã„ãŸæ—¥ï¼‰

1ã€œ3ã‚’ã ã‘ã§ã‚ˆã‘ã‚Œã°DatePickerã§ã‚‚è‰¯ã•ãã†ã§ã™ã€‚

```swift
DatePicker("dateSelect", selection: $date)
     .datePickerStyle(.graphical)
```

https://developer.apple.com/documentation/swiftui/datepicker#Styling-date-pickers

ãŸã ã—ã“ã‚Œã§ã¯4ãŒæº€ãŸã›ã¾ã›ã‚“ã€‚

é ‘å¼µã£ã¦è‡ªä½œã—ã¾ã™ã€‚

`2024/1/18 è¿½è¨˜`
UIKitã«ç”¨æ„ã•ã‚Œã¦ã„ã¾ã—ãŸ

https://developer.apple.com/documentation/uikit/uicalendarview

# ä½œã£ãŸã‚‚ã®
![](https://storage.googleapis.com/zenn-user-upload/e492d422c830-20250116.gif)
# ã‚³ãƒ¼ãƒ‰å…¨ä½“

```swift
import Foundation
import SwiftUI

class DateData {
    let date: Date
    let isEnableColor: Bool
    
    init(date: Date, isEnableColor: Bool) {
        self.date = date
        self.isEnableColor = isEnableColor
    }
}

struct CustomCalendarView: View {
    @State private var currentDate = Date()
    @State private var days: [Date] = []
    @State private var isMonthSelecting: Bool = false
    let height: CGFloat = 320
    var body: some View {
        VStack {
            CustomCalendarHeaderView(
                isMonthSelecting: $isMonthSelecting,
                date: $currentDate
            )
            ZStack {
            // Viewã‚’é‡ã­ã¦Flagã§é€æ˜Žåº¦ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã§
            // ã©ã¡ã‚‰ã‹ä¸€æ–¹ã ã‘ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™
                CustomCalendarGridView(date: $currentDate, days: $days)
                    .frame(height: height)
                    .opacity(isMonthSelecting ? 0 : 1)
                UIKitDatePicker(date: $currentDate)
                    .frame(height: height, alignment: .center)
                    .opacity(isMonthSelecting ? 1 : 0)
            }
        }
        .padding()
        .onAppear {
            days = currentDate.calendarDisplayDays
        }
        .onChange(of: currentDate) {
            days = currentDate.calendarDisplayDays
        }
    }
}

private struct CustomCalendarHeaderView: View {
    @Binding var isMonthSelecting: Bool
    @Binding var date: Date
    
    var body: some View {
        HStack {
            Button {
                withAnimation {
                    isMonthSelecting.toggle()
                }
            } label: {
                HStack {
                    Text("\(date.toStringyyyyM())")
                        .bold()
                        .foregroundStyle(isMonthSelecting ? .blue : Color.black)
                    Image(systemName: "chevron.right")
                        .frame(width: 8, height: 8)
                        .rotationEffect(.degrees(isMonthSelecting ? 90 : 0))
                        .animation(.easeInOut, value: isMonthSelecting)
                        .bold()
                }
            }
            Spacer()
            Button {
                withAnimation {
                    date = Calendar.current.date(byAdding: .month, value: -1, to: date) ?? date
                }
            } label: {
                Image(systemName: "chevron.left")
                    .bold()
                    .padding(8)
            }
            Button {
                withAnimation {
                    date = Calendar.current.date(byAdding: .month, value: 1, to: date) ?? date
                }
            } label: {
                Image(systemName: "chevron.right")
                    .bold()
                    .padding(8)
            }
        }
    }
}
private struct CustomCalendarGridView: View {
    @Binding var date: Date
    @Binding var days: [Date]
    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
    let dateDatas = [
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 2),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 3),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 4),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 6),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 7),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 14),
            isEnableColor: true
        ),
        DateData(
            date: Date(timeIntervalSinceNow: -60 * 60 * 24 * 15),
            isEnableColor: true
        ),
    ]

    let now = Date()
    let daysOfWeek = Calendar.getWeekDates()
    let columns = Array(repeating: GridItem(.flexible(), spacing: 0), count: 7)
    
    var body: some View {
        VStack() {
            HStack {
                ForEach(daysOfWeek, id: \.self) { dayOfWeek in
                    Text(dayOfWeek.toStringWeekday())
                        .fontWeight(.light)
                        .font(.caption)
                        .frame(maxWidth: .infinity)
                }
            }
            LazyVGrid(columns: columns) {
                ForEach(days, id: \.self) { day in
                    let isCurrentMonth = day.monthInt == date.monthInt
                    let isEnableColor = dateDatas.first { dateData in
                        day.isSameDay(date: dateData.date)
                    }?.isEnableColor ?? false
                    let isPreviousDayEnableColor = dateDatas.first { dateData in
                        dateData.date.isSameDay(date: day.addingTimeInterval(-60 * 60 * 24))
                    }?.isEnableColor ?? false
                    let isNextDayEnableColor = dateDatas.first { dateData in
                        dateData.date.isSameDay(date: day.addingTimeInterval(60 * 60 * 24))
                    }?.isEnableColor ?? false
                    Text(day.toStringD())
                        .fontWeight(.bold)
                        .foregroundStyle(day.isSameDay(date: now) ? Color.red : isCurrentMonth ? .primary: .secondary)
                        .frame(maxWidth: .infinity, minHeight: 40)
                        .modifier(CalendarDateBackGroundShape(
                            isCompletedCurrentDate: isEnableColor,
                            isCopmletedPreviousDay: isPreviousDayEnableColor,
                            isCompletedNextDay: isNextDayEnableColor
                        ))
                }
            }
            Spacer()
        }
    }
}

private struct CalendarDateBackGroundShape: ViewModifier {
    let isCompletedCurrentDate: Bool
    let isCopmletedPreviousDay: Bool
    let isCompletedNextDay: Bool
    
    let completedColor = Color.blue
    
    func body(content: Content) -> some View {
        content
            .background(
                GeometryReader{ geometry in
                    let width = geometry.size.width
                    let height = geometry.size.height
                    let halfWidth = geometry.size.width / 2
                    ZStack {
                        Circle()
                            .foregroundStyle(
                                isCompletedCurrentDate
                                ? completedColor
                                : .clear
                            )
                        Rectangle()
                            .foregroundStyle(
                                isCompletedCurrentDate && isCopmletedPreviousDay
                                ? completedColor
                                : .clear
                            )
                            .frame(width: halfWidth, height: height)
                            .offset(x: -(halfWidth / 2))
                        Rectangle()
                            .foregroundStyle(
                                isCompletedCurrentDate && isCompletedNextDay
                                ? completedColor
                                : .clear
                            )
                            .frame(width: halfWidth, height: height)
                            .offset(x: halfWidth / 2)
                    }
                    .frame(width: width, height: height)
                }
            )
    }
}

#Preview {
    return CustomCalendarView()
}

struct CustomUIKitDatePicker: UIViewRepresentable {
    @Binding var date: Date

    func makeUIView(context: Context) -> UIDatePicker {
        let datePicker = UIDatePicker()
        datePicker.datePickerMode = .yearAndMonth
        datePicker.preferredDatePickerStyle = .wheels
        datePicker.addTarget(
            context.coordinator,
            action: #selector(Coordinator.dateChanged(_:)),
            for: .valueChanged
        )
        return datePicker
    }

    func updateUIView(_ uiView: UIDatePicker, context: Context) {
        uiView.date = date
    }

    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }

    class Coordinator: NSObject {
        var parent: CustomUIKitDatePicker

        init(_ parent: CustomUIKitDatePicker) {
            self.parent = parent
        }

        @objc func dateChanged(_ sender: UIDatePicker) {
            parent.date = sender.date
        }
    }
}

extension Calendar {
    static func getWeekDates() -> [Date] {
        let calendar = Calendar.current
        let today = Date()
        let startOfWeek = calendar.date(
            from: calendar.dateComponents(
                [.yearForWeekOfYear, .weekOfYear],
                from: today
            )
        )!
        var weekDates: [Date] = []
        for dayOffset in 0..<7 {
            if let date = calendar.date(byAdding: .day, value: dayOffset, to: startOfWeek) {
                weekDates.append(date)
            }
        }
        return weekDates
    }
}

```

ãã‚Œã£ã½ãã¯ãªã‚Šã¾ã—ãŸãŒã€å®Ÿéš›ã«ä½¿ã†ã«ã¯ã‚‚ã†å°‘ã—è¦‹ãŸç›®ã‚„ã‚³ãƒ¼ãƒ‰ã‚’æ•´ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã”å‚è€ƒç¨‹åº¦ã«ã€‚

ä¸å‚™ã€é–“é•ã„ç­‰ã‚ã‚Œã°ã”æŒ‡æ‘˜é¡˜ã„ã¾ã™ã€‚